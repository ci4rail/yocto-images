header:
  version: 11

repos:
  src/meta-mender-community:
    url: "https://github.com/mendersoftware/meta-mender-community"
    refspec: a8af8f5037435d5a7d776f4c039f31652aa3a741
    layers:
      meta-mender-toradex-nxp:

env:
  MENDER_SERVER_URL: "https://hosted.mender.io"
  MENDER_TENANT_TOKEN: "DEFAULT_EMPTY_TENANT_TOKEN"
  IMAGE_NAME_SUFFIX: ""
  MENDER_ARTIFACT_NAME: "DEFAULT_EMPTY_ARTIFACT_NAME"

local_conf_header:
  # from meta-mender-community/meta-mender-toradex-nxp/templates/local.conf.append
  src/meta-ci4rail-mender-tdxbsp: |
    INHERIT += "mender-toradex"
    # meta-mender-community needs the BSP version...
    # TORADEX_BSP_VERSION = "toradex-bsp-5.7.0" ???

    # Comment/remove below to enable GRUB integration instead of U-Boot
    MENDER_FEATURES_ENABLE:append = " mender-uboot mender-image-sd"
    MENDER_FEATURES_DISABLE:append = " mender-grub mender-image-uefi"

    IMAGE_CLASSES += "image_type_mender_tezi"
    IMAGE_FSTYPES:append = " mender_tezi"
    IMAGE_FSTYPES:remove = " teziimg"

    # Default is Image.gz, which is not compatible with GRUB
    KERNEL_IMAGETYPE:aarch64_mender-grub = "Image"

    # boot.scr conflicts when using GRUB
    IMAGE_BOOT_FILES:remove:mender-grub = "boot.scr-verdin-imx8mm;boot.scr"

    # Remove files from boot partition that are loaded by Mender
    # from the root partitions; this allows the files to be updated OTA
    IMAGE_BOOT_FILES:remove:mender-uboot = "zImage ${KERNEL_DEVICETREE} overlays.txt overlays/*;overlays/"

    #
    # Settings for verdin-imx8mm
    #
    MENDER_BOOT_PART_SIZE_MB:verdin-imx8mm = "32"
    OFFSET_SPL_PAYLOAD:verdin-imx8mm = ""
    KERNEL_DEVICETREE:verdin-imx8mm = "freescale/imx8mm-verdin-wifi-dahlia.dtb"

    #
    # Settings for verdin-imx8mp
    #
    MENDER_BOOT_PART_SIZE_MB:verdin-imx8mp = "32"
    OFFSET_SPL_PAYLOAD:verdin-imx8mp = ""
    MENDER_IMAGE_BOOTLOADER_BOOTSECTOR_OFFSET:verdin-imx8mp = "0"
    MENDER_UBOOT_STORAGE_INTERFACE:verdin-imx8mp = "mmc"
    MENDER_UBOOT_STORAGE_DEVICE:verdin-imx8mp = "2"
    MENDER_STORAGE_DEVICE:verdin-imx8mp = "/dev/mmcblk2"
    #MENDER_STORAGE_TOTAL_SIZE_MB:verdin-imx8mp = "2048"
    KERNEL_DEVICETREE:verdin-imx8mp = "freescale/imx8mp-verdin-wifi-dahlia.dtb"
